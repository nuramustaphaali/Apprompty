{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="{% url 'dashboard' %}" style="color: #6b7280; text-decoration: none;">&larr; Dashboard</a>
    <span style="margin: 0 10px; color: #d1d5db;">|</span>
    <span style="color: #374151; font-weight: 500;">Logic Engine Debugger</span>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    
    <div>
        <h2 style="margin-top: 0;">State Machine Status</h2>
        <div style="background: white; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px;">
            <div style="margin-bottom: 15px;">
                <label style="display: block; font-size: 0.75em; color: #6b7280; text-transform: uppercase;">Progress</label>
                <div style="background: #f3f4f6; height: 10px; border-radius: 5px; margin-top: 5px; overflow: hidden;">
                    <div style="background: #2563eb; width: {{ state.progress_percent }}%; height: 100%;"></div>
                </div>
                <div style="text-align: right; font-size: 0.8em; color: #2563eb; margin-top: 2px;">{{ state.progress_percent }}%</div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; font-size: 0.75em; color: #6b7280; text-transform: uppercase;">Current Active Stage</label>
                <code style="font-size: 1.2em; font-weight: bold; color: #dc2626;">
                    {% if state.is_completed %}COMPLETE{% else %}{{ state.current_stage }}{% endif %}
                </code>
            </div>

            <div>
                <label style="display: block; font-size: 0.75em; color: #6b7280; text-transform: uppercase;">Raw JSON Store</label>
                <pre style="background: #111827; color: #10b981; padding: 10px; border-radius: 6px; font-size: 0.8em; overflow-x: auto;">{{ state.answers_so_far|pprint }}</pre>
            </div>
        </div>
    </div>

    <div>
        <h2 style="margin-top: 0;">Simulate Input</h2>
        <div style="background: white; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px;">
            <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 20px;">
                Try to submit answers out of order. The Engine should block you.
            </p>

            {% for stage in stages %}
            <form method="POST" style="margin-bottom: 15px; padding: 10px; border: 1px solid {% if stage == state.current_stage %}#2563eb{% else %}#e5e7eb{% endif %}; border-radius: 6px; background: {% if stage in state.answers_so_far %}#f0fdf4{% elif stage == state.current_stage %}#eff6ff{% else %}#f9fafb{% endif %};">
                {% csrf_token %}
                <input type="hidden" name="stage" value="{{ stage }}">
                
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <strong style="text-transform: capitalize; {% if stage == state.current_stage %}color: #2563eb;{% endif %}">{{ stage }}</strong>
                    
                    {% if stage in state.answers_so_far %}
                        <span style="font-size: 0.8em; color: #059669;">✓ Saved</span>
                    {% elif stage == state.current_stage %}
                        <span style="font-size: 0.8em; color: #2563eb;">● Active</span>
                    {% else %}
                        <span style="font-size: 0.8em; color: #9ca3af;">Locked</span>
                    {% endif %}
                </div>

                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <input type="text" name="answer" placeholder="Simulate answer..." required style="flex: 1; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <button type="submit" style="background: white; border: 1px solid #d1d5db; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Submit</button>
                </div>
            </form>
            {% endfor %}
            
            {% if state.is_completed %}
            <div style="margin-top: 20px; text-align: center;">
                <button style="background: #059669; color: white; padding: 10px 20px; border: none; border-radius: 6px; width: 100%; font-weight: 600;">Proceed to Requirement Lock</button>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}